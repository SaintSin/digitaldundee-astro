---
import { getCollection } from 'astro:content';
import Breadcrumbs from '@components/Breadcrumbs.astro';
import Hero from '@components/Hero.astro';
import header from '@images/header/news.jpg';
import Layout from '@layouts/BaseLayout.astro';
import type { CollectionPage } from '@types';
import { getArchiveEntries } from '@utils/newsArchive';
import {
  BREADCRUMB_LABELS,
  digitalDundeeOrganization,
  generateBreadcrumbs,
} from '@utils/schema';

const news = await getCollection('news');
const archiveEntries = getArchiveEntries(news);

const collectionPageSchema: CollectionPage = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: 'News Archive',
  description: 'Browse news articles by month and year',
  url: `${digitalDundeeOrganization.url}/news-archive`,
  breadcrumb: generateBreadcrumbs(Astro.url.pathname, BREADCRUMB_LABELS),
};

const meta = {
  title: 'News Archive | Digital Dundee',
  description: 'Browse news articles by month and year',
  imageOG: 'generic-social-1200x630.png',
  altOG: 'Digital Dundee News Archive',
  schema: [digitalDundeeOrganization, collectionPageSchema],
};
---

<Layout metaData={meta}>
  <Hero title="News Archive" image={header} alt="News page header" />

  <main class="wrapper flow">
    <Breadcrumbs
      customLabels={{
        'news-archive': 'News Archive',
      }}
    />

    <p>
      Browse our news articles by month, we have {news.length} articles spanning {
        archiveEntries.length
      } months.
    </p>

    <ul class="news-archive">
      {
        archiveEntries.map((entry) => (
          <li>
            <a href={`/news-archive/${entry.yearMonth}`}>
              <p>
                {entry.label}{' '}
                <i>
                  {entry.count} {entry.count === 1 ? 'article' : 'articles'}
                </i>
              </p>
            </a>
          </li>
        ))
      }
    </ul>
  </main>
</Layout>
<style>
  .news-archive {
    columns: 2;
    margin-top: var(--space-xs);
    padding: 0;
    list-style: none;
    li {
      margin-block-end: var(--space-2xs);
      a {
        text-decoration: none;
      }
    }
  }
  @media (min-width: 1024px) {
    .news-archive {
      columns: 3;
    }
  }
</style>
