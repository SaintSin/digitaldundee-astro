---
import { getCollection } from 'astro:content';
import Breadcrumbs from '@components/Breadcrumbs.astro';
import Hero from '@components/Hero.astro';
import header from '@images/header/news.jpg';
import Layout from '@layouts/BaseLayout.astro';
import type { CollectionPage } from '@types';
import { getArchiveEntries } from '@utils/newsArchive';
import {
  BREADCRUMB_LABELS,
  digitalDundeeOrganization,
  generateBreadcrumbs,
} from '@utils/schema';

const news = await getCollection('news');
const archiveEntries = getArchiveEntries(news);

const collectionPageSchema: CollectionPage = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: 'News Archive',
  description: 'Browse news articles by month and year',
  url: `${digitalDundeeOrganization.url}/news-archive`,
  breadcrumb: generateBreadcrumbs(Astro.url.pathname, BREADCRUMB_LABELS),
};

const meta = {
  title: 'News Archive | Digital Dundee',
  description: 'Browse news articles by month and year',
  imageOG: 'generic-social-1200x630.png',
  altOG: 'Digital Dundee News Archive',
  schema: [digitalDundeeOrganization, collectionPageSchema],
};
---

<Layout metaData={meta}>
  <Hero title="News Archive" image={header} alt="News page header" />

  <main class="wrapper flow">
    <Breadcrumbs
      customLabels={{
        'news-archive': 'News Archive',
      }}
    />

    <p>
      Browse our news articles by month, we have {news.length} articles spanning {
        archiveEntries.length
      } months.
    </p>

    <div class="archive-grid">
      {
        archiveEntries.map((entry) => (
          <article class="archive-card">
            <a href={`/news-archive/${entry.yearMonth}`}>
              <h3>{entry.label}</h3>
              <p class="article-count">
                {entry.count} {entry.count === 1 ? 'article' : 'articles'}
              </p>
            </a>
          </article>
        ))
      }
    </div>
  </main>
</Layout>

<style>
  .archive-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: var(--space-s);
    margin-block-end: var(--space-l);
  }

  .archive-card {
    transition: all 0.2s ease;
    border: 1px solid var(--color-border, #ddd);
    border-radius: 8px;
    padding: var(--space-s);
  }

  .archive-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border-color: var(--color-primary, #0066cc);
  }

  .archive-card a {
    display: block;
    color: inherit;
    text-decoration: none;
  }

  .archive-card h3 {
    margin: 0;
    margin-block-end: var(--space-3xs);
    color: var(--color-primary, #0066cc);
    font-size: var(--step-0);
  }

  .article-count {
    margin: 0;
    color: var(--color-text-muted, #666);
    font-size: var(--step--1);
  }

  .archive-navigation {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-s);
    margin-block-start: var(--space-l);
  }
</style>
