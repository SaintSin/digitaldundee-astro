---
import { getCollection, render } from 'astro:content';
import header from '@images/header/news.jpg';
import Layout from '@layouts/BaseLayout.astro';
import type { NewsArticle } from '@types';
import {
  BREADCRUMB_LABELS,
  digitalDundeeOrganization,
  generateBreadcrumbs,
  SITE_URL,
} from '@utils/schema';

export async function getStaticPaths() {
  const news = await getCollection('news');
  return news.map((article) => ({
    params: { id: article.id },
    props: { article },
  }));
}

import Breadcrumbs from '@components/Breadcrumbs.astro';
import Hero from '@components/Hero.astro';

const { article } = Astro.props;
const { Content } = await render(article);

const newsArticleSchema: NewsArticle = {
  '@context': 'https://schema.org',
  '@type': 'NewsArticle',
  headline: article.data.title,
  description: article.data.seo.description,
  datePublished: article.data.pubDate.toISOString(),
  author: digitalDundeeOrganization,
  publisher: digitalDundeeOrganization,
  url: `${SITE_URL}/news/${article.id}`,
};

const meta = {
  title: article.data.seo.title,
  description: article.data.seo.description,
  imageOG: article.data.seo.ogImage || article.data.imagePrimary.src,
  altOG: article.data.imagePrimary.alt,
  schema: [digitalDundeeOrganization, newsArticleSchema],
};
---

<Layout metaData={meta}>
  <Hero title={article.data.title} image={header} alt="News page header" />

  <Breadcrumbs />

  <h2>{article.data.title}</h2>
  <main class="wrapper flow">
    <Content />
  </main>
</Layout>
