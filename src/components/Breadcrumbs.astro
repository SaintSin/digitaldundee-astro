---
interface Props {
  customLabels?: Record<string, string>;
}

const { customLabels = {} } = Astro.props;

// Get the current pathname and split into segments
const pathname = Astro.url.pathname;
const segments = pathname.split('/').filter((segment) => segment !== '');

// Build breadcrumb items
const breadcrumbs = segments
  .map((segment, index) => {
    // Build the path up to this segment
    const path = '/' + segments.slice(0, index + 1).join('/');

    // Check if this is a number (likely a page number or ID)
    const isNumber = /^\d+$/.test(segment);

    // Format the label
    let label = customLabels[segment] || segment;

    // If not a custom label, format the segment
    if (!customLabels[segment]) {
      // Remove hyphens and capitalize words
      label = segment
        .split('-')
        .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');
    }

    // Don't show page numbers in breadcrumbs, skip them
    if (isNumber && !customLabels[segment]) {
      return null;
    }

    return {
      label,
      path,
      isLast: index === segments.length - 1,
    };
  })
  .filter(Boolean); // Remove null entries

// Always include Home as the first breadcrumb if there are any segments
const allBreadcrumbs =
  segments.length > 0
    ? [{ label: 'Home', path: '/', isLast: false }, ...breadcrumbs]
    : [];

// Update the last item to be marked as last
if (allBreadcrumbs.length > 0) {
  allBreadcrumbs.forEach((crumb, index) => {
    if (crumb) crumb.isLast = index === allBreadcrumbs.length - 1;
  });
}
---

{
  allBreadcrumbs.length > 0 && (
    <nav aria-label="Breadcrumb" class="breadcrumbs">
      <ol class="breadcrumbs__list">
        {allBreadcrumbs.map((crumb, index) => (
          <li class="breadcrumbs__item">
            {crumb.isLast ? (
              <span class="breadcrumbs__current" aria-current="page">
                {crumb.label}
              </span>
            ) : (
              <>
                <a href={crumb.path} class="breadcrumbs__link">
                  {crumb.label}
                </a>
                <span class="breadcrumbs__separator" aria-hidden="true">
                  /
                </span>
              </>
            )}
          </li>
        ))}
      </ol>
    </nav>
  )
}

<style>
  .breadcrumbs {
    margin-block-end: var(--space-m, 1.5rem);
  }

  .breadcrumbs__list {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
    padding: 0;
    list-style: none;
  }

  .breadcrumbs__item {
    display: flex;
    align-items: center;
    gap: calc(var(--gap) * 0.5);
    font-size: var(--step--1, 0.875rem);
    text-transform: uppercase;
  }

  .breadcrumbs__link {
    transition: color 0.2s;
    color: var(--color-text-subtle, #007bff);
    text-decoration: none;
  }

  .breadcrumbs__link:hover {
    color: var(--color-text, #0056b3);
    text-decoration: underline;
  }

  .breadcrumbs__current {
    color: var(--color-text, #666);
    font-weight: 500;
  }

  .breadcrumbs__separator {
    color: var(--color-text-muted, #999);
  }

  @media (max-width: 640px) {
    .breadcrumbs__list {
      font-size: 0.8125rem;
    }
  }
</style>
