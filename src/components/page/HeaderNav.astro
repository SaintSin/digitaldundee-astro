---
// @components/page/HeaderNav.astro
import { Icon } from 'astro-icon/components';

const { pathname } = Astro.url;

const links = [
  { label: 'Home', href: '/' },
  { label: 'About', href: '/about/' },
  {
    label: 'Be Dundee',
    href: '/be-dundee/',
    children: [
      { label: 'Dummy Link 1', href: '/be-dundee/link1/' },
      { label: 'Dummy Link 2', href: '/be-dundee/link2/' },
    ],
  },
  {
    label: 'Tay5G',
    href: '/tay5g/',
    children: [
      { label: 'Dummy Link 1', href: '/tay5g/link1/' },
      { label: 'Dummy Link 2', href: '/tay5g/link2/' },
    ],
  },
  { label: 'Resources', href: '/resources/' },
  { label: 'News', href: '/news/' },
  { label: 'Events', href: '/events/' },
  { label: 'Meet The Companies', href: '/meet-companies/' },
  { label: 'Success Stories', href: '/success-stories/' },
  { label: 'Contact Us', href: '/contact/' },
];
---

<nav class="main-nav">
  <!-- Mobile menu button -->
  <button
    type="button"
    class="mobile-menu-button"
    popovertarget="mobile-menu"
    aria-label="Open menu"
  >
    <Icon name="ri:menu-line" />
  </button>

  <!-- Desktop navigation -->
  <div class="nav-links">
    {
      links.map((link, index) => {
        const isActive = pathname === link.href;

        if (link.children) {
          // Link with dropdown
          return (
            <div class="nav-item has-dropdown">
              <a class:list={[{ 'active--exact': isActive }]} href={link.href}>
                {link.label}
                <Icon name="ri:arrow-down-s-line" class="dropdown-icon" />
              </a>
              <div class="dropdown-menu">
                {link.children.map((child) => (
                  <a
                    href={child.href}
                    class:list={[{ 'active--exact': pathname === child.href }]}
                  >
                    {child.label}
                  </a>
                ))}
              </div>
            </div>
          );
        } else {
          // Regular link
          return (
            <a class:list={[{ 'active--exact': isActive }]} href={link.href}>
              {link.label}
            </a>
          );
        }
      })
    }
  </div>

  <!-- Mobile menu dialog -->
  <div id="mobile-menu" popover class="mobile-menu">
    <div class="mobile-menu-header">
      <span>Menu</span>
      <button
        type="button"
        popovertarget="mobile-menu"
        popovertargetaction="hide"
        aria-label="Close menu"
        class="close-button"
      >
        <Icon name="ri:close-line" />
      </button>
    </div>
    <div class="mobile-menu-content">
      {
        links.map((link) => {
          const isActive = pathname === link.href;

          if (link.children) {
            return (
              <div class="mobile-nav-section">
                <a
                  href={link.href}
                  class:list={[
                    'mobile-main-link',
                    { 'active--exact': isActive },
                  ]}
                >
                  {link.label}
                </a>
                {link.children.map((child) => (
                  <a
                    href={child.href}
                    class:list={[
                      'mobile-sub-link',
                      { 'active--exact': pathname === child.href },
                    ]}
                  >
                    {child.label}
                  </a>
                ))}
              </div>
            );
          } else {
            return (
              <a class:list={[{ 'active--exact': isActive }]} href={link.href}>
                {link.label}
              </a>
            );
          }
        })
      }
    </div>
  </div>
</nav>

<style>
  .main-nav {
    position: relative;
    container-name: nav;
    container-type: inline-size;
  }

  /* Mobile menu button - hidden on desktop */
  .mobile-menu-button {
    display: none;
    cursor: pointer;
    border: none;
    background: transparent;
    padding: var(--space-2xs);
    color: black;
    font-size: var(--step-2);

    @container nav (width < 768px) {
      display: block;
    }
  }

  /* Desktop navigation */
  .nav-links {
    display: inline-flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-s);

    @container nav (width < 768px) {
      display: none;
    }

    a {
      padding: var(--space-2xs);
      color: black;
      font-weight: 500;
      font-size: var(--step--2);
      font-family: var(--font-montserrat);
      letter-spacing: 1px;
      text-decoration: none;
      text-transform: uppercase;
      white-space: nowrap;

      &:hover {
        text-decoration: underline;
        text-decoration-thickness: 2px;
        text-underline-offset: var(--space-3xs);
      }
    }

    .active--exact {
      text-decoration: underline;
      text-decoration-thickness: 2px;
      text-underline-offset: var(--space-3xs);
    }
  }

  .nav-item {
    display: inline-flex;
    position: relative;
    align-items: center;
  }

  /* Dropdown items - show icon inline with text */
  .nav-item.has-dropdown > a {
    display: inline-flex;
    align-items: center;
    gap: var(--space-3xs);
  }

  .dropdown-icon {
    transition: transform 0.2s ease;
    font-size: var(--step-0);
  }

  /* Rotate icon when dropdown is open */
  .nav-item.has-dropdown:hover .dropdown-icon,
  .nav-item.has-dropdown:focus-within .dropdown-icon {
    transform: rotate(180deg);
  }

  /* Dropdown menu - hidden by default */
  .dropdown-menu {
    display: flex;
    position: absolute;
    top: 100%;
    left: 0;
    flex-direction: column;
    gap: 0;
    transform: translateY(calc(-1 * var(--space-xs)));
    visibility: hidden;

    /* Hidden by default */
    opacity: 0;
    z-index: 100;
    transition:
      opacity 0.2s ease,
      visibility 0.2s ease,
      transform 0.2s ease;
    margin-top: var(--space-2xs);
    box-shadow: var(--shadow-3);
    border: 1px solid var(--gray-4);
    border-radius: var(--radius-2);
    background: white;
    padding: 0;
    min-width: 12rem;

    /* Show on hover or focus */
    .nav-item.has-dropdown:hover &,
    .nav-item.has-dropdown:focus-within & {
      transform: translateY(0);
      visibility: visible;
      opacity: 1;
    }

    a {
      border-bottom: 1px solid var(--gray-2);
      padding: var(--space-xs) var(--space-s);
      color: black;
      font-size: var(--step--1);
      font-family: var(--font-montserrat);
      letter-spacing: 0.5px;
      text-decoration: none;
      text-transform: none;
      white-space: nowrap;

      &:first-child {
        border-radius: var(--radius-2) var(--radius-2) 0 0;
      }

      &:last-child {
        border-bottom: none;
        border-radius: 0 0 var(--radius-2) var(--radius-2);
      }

      &:hover,
      &:focus {
        outline: none;
        background: var(--gray-1);
      }

      &.active--exact {
        background: var(--gray-2);
        font-weight: 600;
      }
    }
  }

  /* Mobile menu (popover as full-screen overlay) */
  .mobile-menu {
    /* Popover animations */
    opacity: 0;
    transition:
      opacity 0.3s,
      display 0.3s allow-discrete,
      overlay 0.3s allow-discrete;
    margin: 0;
    inset: 0;
    border: none;
    background: white;
    padding: 0;
    width: 100vw;
    max-width: 100vw;
    height: 100vh;
    max-height: 100vh;

    &:popover-open {
      opacity: 1;
    }

    @starting-style {
      &:popover-open {
        opacity: 0;
      }
    }
  }

  .mobile-menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 2px solid var(--gray-3);
    padding: var(--space-s);
    font-weight: 600;
    font-size: var(--step-1);
    font-family: var(--font-montserrat);
    text-transform: uppercase;
  }

  .close-button {
    cursor: pointer;
    border: none;
    background: transparent;
    padding: var(--space-2xs);
    color: black;
    font-size: var(--step-2);
  }

  .mobile-menu-content {
    display: flex;
    flex-direction: column;
    gap: 0;
    padding: var(--space-s);

    a {
      border-bottom: 1px solid var(--gray-2);
      padding: var(--space-s);
      color: black;
      font-size: var(--step-0);
      font-family: var(--font-montserrat);
      letter-spacing: 1px;
      text-decoration: none;
      text-transform: uppercase;

      &:hover {
        background: var(--gray-1);
      }

      &.active--exact {
        background: var(--gray-2);
        font-weight: 600;
      }
    }
  }

  .mobile-nav-section {
    display: flex;
    flex-direction: column;
    border-bottom: 2px solid var(--gray-3);

    .mobile-main-link {
      border-bottom: 1px solid var(--gray-3);
      background: var(--gray-1);
      font-weight: 600;
    }

    .mobile-sub-link {
      padding-left: var(--space-l);
      font-size: var(--step--1);
      text-transform: none;
    }
  }
</style>
